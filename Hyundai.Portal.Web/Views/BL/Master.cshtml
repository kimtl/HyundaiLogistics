@{
    ViewBag.Title = "Master";
}

<a href="#"><strong><i class="glyphicon glyphicon-dashboard"></i>Master BL 관리</strong></a>
<hr />
<div class="panel panel-default">
    <div class="panel-body">
        <form class="form-inline" role="form" id="frmMBL">
            <div class="form-group">
                <label for="startDate" class="searchTitle">
                    Search By</label>
                <select id="searchKey" class="form-control">
                    <option value="MasterBL">Master BL No</option>
                </select>
            </div>
            <div class="form-group">
                <input type="text" id="searchText" class="k-textbox" placeholder="Search text" />
            </div>
            <button id="btnSearch" type="button" class="btn btn-default">
                Search</button>
            <button id="btnRegister" type="button" class="btn btn-primary">
                Register</button>
        </form>
    </div>
</div>
<div>
    Total : <span id="totalCnt"></span>
</div>
<div id="MBLList"></div>

<script type="text/javascript">
    $(document).ready(function () {
        var editMBL = function (e) {
            var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
            location.href = "/BL/MBLDetail?midx=" + dataItem.midx;
        };
        var viewPDF = function (e) {
            var dataItem = this.dataItem($(e.currentTarget).closest("tr"));
            $.ajax({
                url: "/BL/MBLPDF",
                data: { midx: dataItem.midx },
                success: function (result) {
                    window.open(result.SmallUrl, "", "");
                },
                dataType: "json"
            });
        }


        $("#MBLList").kendoGrid({
            height: 300,
            autoSize: true,
            dataSource: {
                type: "json",
                transport: {
                    read: "/BL/getMBLList"
                },
                pageSize: 20,
                serverPaging: false,
                serverFiltering: false,
                serverSorting: false,
                schema: {
                    model: {
                        id: "midx",
                        fields: {
                            midx: { editable: false, nullable: true },
                            mblNo: { validation: { required: true} },
                            ShipperName: { validation: { required: true} },
                            CneeName: { validation: { required: true} },
                            DestName: { validation: { required: true} },
                            TotalAmt: { validation: { required: true} },
                            CreateDate: { type: "date", validation: { required: true} }
                        }
                    }
                }
            },
            scrollable: {
                virtual: true
            },
            columns: [
                { field: "mblNo", title: "MBL No" },
                { field: "ShipperName", title: "Shipper Name" },
                { field: "CneeName", title: "Consignee Name" },
                { field: "DestName", title: "Destination" },
                { field: "TotalAmt", title: "Total Amount" },
                {
                    field: "CreateDate",
                    title: "등록일자",
                    template: "#= kendo.toString(CreateDate, 'g') #"
                },

                { command: [{ text: "Edit", click: editMBL }, { text: "PDF", click: viewPDF}], title: "Command", width: 160 }
            ],
            dataBound: function (e) {
                var cnt = $('#MBLList').data('kendoGrid').dataSource.total();
                $("#totalCnt").text(cnt);
            }
        });

        $("#btnSearch").click(function () {
            var gridObj = $("#MBLList").data("kendoGrid");
            gridObj.dataSource.transport.options.read.url = String.format("/BL/getMBLList?searchKey={0}&searchText={1}", $("#searchKey").val(), $("#searchText").val());
            gridObj.dataSource.read();
        });

        $("#btnRegister").click(function () {
            location.href = "/BL/MBLDetail";
        });
    });
</script>